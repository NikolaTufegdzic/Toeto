using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class BlockGenerator : MonoBehaviour
{
    public static BlockGenerator Instance { get; private set;}
    [SerializeField] private Sprite[] blocksOne;
    [SerializeField] private Block block;
    [SerializeField] private BulletTarget bulletTarget;
    [SerializeField] private GameObject bulletTargets;
    private int[,] stageOneBlocks;
    private int[,] stageOneRotations;
    private int[,] stageTwoBlocks;
    private int[,] stageTwoRotations;
    private int[,] stageThreeBlocks;
    private int[,] stageThreeRotations;
    private const float cornerX = -8.17f;
    private const float cornerY = 4.2f;
    
    private void Awake(){
        Instance = this;
    }
    void Start()
    {
        stageOneBlocks = new int[,]
        {
            {0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 3, 0, 0, 3, 0, 0, 3, 0},
            {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 8, 0, 1, 8, 0, 1, 8, 0},
            {0, 0, 1, 1, 1, 1, 3, 11, 1, 0, 0, 0, 1, 11, 3, 1, 5, 8, 8, 13, 8, 8, 5, 1},
            {0, 0, 0, 0, 1, 3, 11, 3, 1, 1, 0, 1, 1, 3, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1},
            {0, 0, 0, 1, 1, 2, 3, 1, 1, 0, 0, 0, 1, 1, 1, 5, 5, 1, 3, 11, 14, 14, 11, 1},
            {1, 1, 1, 1, 1, 1, 1, 5, 8, 3, 0, 3, 8, 5, 1, 5, 6, 8, 5, 14, 1, 1, 13, 14},
            {0, 0, 1, 3, 8, 5, 1, 8, 1, 0, 0, 0, 0, 8, 1, 1, 8, 11, 14, 11, 1, 9, 13, 1},
            {0, 1, 1, 1, 1, 8, 1, 8, 0, 0, 0, 0, 1, 8, 1, 3, 5, 14, 1, 1, 1, 1, 9, 1},
            {0, 0, 1, 3, 8, 13, 1, 13, 8, 3, 0, 3, 8, 13, 1, 11, 14, 11, 1, 11, 11, 1, 1, 1},
            {1, 1, 1, 1, 1, 8, 1, 8, 1, 0, 0, 0, 0, 8, 1, 14, 1, 1, 1, 11, 12, 14, 14, 14},
            {1, 5, 14, 8, 14, 5, 1, 8, 0, 0, 0, 0, 1, 8, 1, 14, 1, 9, 1, 1, 14, 1, 1, 1},
            {1, 8, 1, 1, 1, 1, 1, 5, 8, 3, 0, 3, 8, 5, 1, 11, 13, 13, 9, 1, 14, 1, 11, 14},
            {1, 13, 14, 8, 14, 3, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 14, 1, 1, 1, 14, 1, 14, 2},

        };
        stageOneRotations = new int[,]
        {
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 180, 0, 0, 180, 0, 0, 180, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 270, 180, 0, 0, 0, 0, 0, 270, 90, 0, 0, 270, 270, 180, 270, 270, 90, 0},
            {0, 0, 0, 0, 0, 270, 180, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 180, 0, 180, 270, 270, 270, 180, 0},
            {0, 0, 0, 0, 0, 0, 0, 270, 270, 90, 0, 270, 270, 180, 0, 0, 0, 270, 90, 0, 0, 0, 90, 90},
            {0, 0, 0, 270, 270, 180, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 270, 90, 0, 270, 270, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 90,0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 270, 90, 270, 0, 90, 270, 90, 0, 270, 270, 270, 0, 270, 270, 90, 0, 270, 180, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 270, 270},
            {0, 270, 270, 270, 270, 90, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 180, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 270, 90, 0, 270, 270, 90, 0, 0, 0, 180, 90, 0, 0, 0, 270, 270},
            {0, 90, 270, 270, 270, 90, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},

        };
        stageTwoBlocks = new int[,]
        {
            {0, 0, 3, 14, 5, 1, 0, 1, 0, 1, 0, 0, 0, 9, 0, 0, 9, 0, 3, 8, 8, 5, 10, 3},
            {0, 3, 14, 8, 7, 1, 1, 1, 1, 1, 0, 0, 11, 13, 11, 0, 14, 1, 1, 1, 1, 5, 8, 6},
            {9, 14, 8, 8, 6, 8, 14, 8, 14, 5, 0, 9, 13, 10, 11, 14, 11, 1, 9, 1, 9, 1, 1, 8},
            {0, 3, 14, 8, 7, 1, 1, 1, 1, 14, 0, 0, 11, 11, 1, 1, 1, 1, 14, 1, 14, 9, 8, 6},
            {0, 0, 3, 14, 5, 1, 1, 1, 1, 8, 0, 0, 0, 14, 1, 11, 14, 14, 8, 14, 8, 14, 14, 8},
            {9, 0, 0, 1, 1, 3, 14, 5, 1, 14, 0, 9, 14, 11, 1, 14, 0, 0, 14, 0, 14, 0, 5, 7},
            {14, 9, 0, 0, 3, 14, 8, 7, 1, 8, 0, 0, 1, 1, 1, 14, 0, 11, 13, 8, 11, 0, 8, 4},
            {13, 13, 0, 9, 14, 8, 8, 6, 8, 12, 14, 11, 1, 9, 14, 8, 14, 13, 1, 1, 1, 0, 3, 1},
            {14, 9, 0, 0, 3, 14, 8, 7, 1, 8, 1, 8, 1, 1, 1, 14, 0, 8, 1, 10, 1, 11, 14, 14},
            {9, 0, 0, 1, 1, 3, 14, 5, 1, 8, 1, 8, 1, 9, 14, 8, 14, 11, 1, 1, 1, 11, 14, 13},
            {0, 0, 3, 14, 5, 1, 1, 1, 1, 8, 2, 5, 5, 1, 9, 14, 0, 0, 0, 11, 11, 1, 5, 7},
            {0, 3, 14, 8, 7, 1, 1, 1, 1, 8, 4, 10, 8, 1, 8, 14, 5, 8, 3, 14, 14, 5, 5, 1},
            {9, 14, 8, 8, 6, 8, 14, 8, 14, 12, 14, 14, 6, 8, 6, 8, 7, 4, 1, 14, 13, 7, 1, 2},

        };
        stageTwoRotations = new int[,]
        {
            {0, 0, 270, 90, 180, 0, 0, 0, 0, 0, 0, 0, 0, 180, 0, 0, 180, 0, 270, 90, 90, 180, 0, 180},
            {0, 270, 90, 90, 270, 0, 0, 0, 0, 0, 0, 0, 270, 180, 180, 0, 0, 0, 0, 0, 0, 0, 90, 0},
            {270, 90, 90, 90, 0, 90, 90, 90, 90, 180, 0, 270, 270, 0, 0, 90, 90, 0, 180, 0, 180, 0, 0, 0},
            {0, 270, 90, 90, 270, 0, 0, 0, 0, 0, 0, 0, 0, 180, 0, 0, 0, 0, 0, 0, 0, 270, 90, 0},
            {0, 0, 270, 90, 90, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 90, 90, 0, 90, 0, 90, 90, 0},
            {180, 0, 0, 0, 0, 270, 90, 180, 0, 0, 0, 270, 90, 90, 0, 0, 0, 0, 0, 0, 0, 0, 270, 180},
            {0, 180, 0, 0, 270, 90, 90, 270, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 180, 90, 90, 0, 0, 0},
            {90, 270, 0, 270, 90, 90, 90, 0, 90, 0, 90, 180, 0, 270, 90, 90, 270,270, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 270, 270, 270, 270, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 270, 270},
            {0, 0, 0, 0, 0, 270, 270, 90, 0, 0, 0, 0, 0, 270, 270, 270, 270, 90, 0, 0, 0, 0, 270, 0},
            {0, 0, 270, 270, 180, 0, 0, 0, 0, 0, 0, 0, 180, 0, 180, 0, 0, 0, 0, 270, 180, 0, 270, 180},
            {0, 270, 270, 270, 270, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 270, 270, 0, 0, 270, 90, 0},
            {270, 270, 270, 270, 0, 270, 270, 270, 270, 0, 270, 270, 0, 270, 0, 270, 270, 0, 0, 0, 90, 270, 0, 0},

        };
        stageThreeBlocks = new int[,]
        {
            {0, 0, 9 , 0, 9, 0, 9, 0, 9, 0, 0, 0, 9, 0, 9, 0, 9, 0, 9, 0, 9, 0, 0, 9},
            {0, 9, 5, 1, 14, 0, 14, 1, 5, 9, 0, 9, 5, 1, 11, 14, 6, 14, 11, 4, 13, 14, 8, 12},
            {0, 0, 1, 1, 5, 14, 5, 1, 1, 0, 0, 0, 1, 1, 1, 1, 11, 14, 11, 4, 11, 11, 10, 14},
            {0, 9, 5, 1, 1, 1, 1, 1, 5, 9, 0, 9, 11, 1, 10, 1, 1, 5, 11, 1, 1, 11, 11, 14},
            {0, 0, 13, 14, 5, 1, 5, 14, 13, 0, 0, 0, 14, 1, 1, 10, 1, 14, 1, 1, 1, 1, 11, 12},
            {0, 9, 13, 0, 13, 8, 13, 0, 13, 9, 0, 9, 6, 11, 1, 1, 5, 13, 5, 1, 5, 5, 1, 14},
            {0, 0, 13, 14, 5, 1, 5, 14, 13, 0, 0, 0, 14, 14, 5, 14, 13, 4, 5, 14, 5, 5, 14, 13},
            {0, 9, 5, 1, 1, 1, 1, 1, 5, 9, 0, 9, 11, 11, 11, 0, 5, 5, 1, 1, 1, 1, 1, 1},
            {0, 0, 1, 5, 8, 14, 8, 5, 1, 0, 0, 0, 4, 4, 0, 0, 0, 14, 1, 4, 1, 5, 5, 1},
            {9, 14, 5, 5, 5, 5, 8, 5, 1, 1, 0, 1, 1, 11, 11, 0, 5, 5, 1, 1, 5, 5, 14, 1},
            {0, 1, 14, 5, 5, 5, 8, 8, 5, 1, 9, 1, 11, 11, 14, 0, 5, 5, 1, 5, 5, 1, 14, 1},
            {0, 1, 5, 7, 5, 5, 8, 8, 5, 1, 14, 11, 11, 10, 8, 0, 0, 14, 1, 5, 14, 14, 6, 14},
            {9, 14, 14, 14, 13, 13, 14, 14, 14, 14, 12, 12, 14, 14, 12, 14, 14, 13, 1, 1, 1, 1, 14, 4},

        };
        stageThreeRotations = new int[,]
        {
            {0, 0, 180, 0, 180, 0, 180, 0, 180, 0, 0, 0, 180, 0, 180, 0, 180, 0, 180, 0, 180, 0, 0, 180},
            {0, 270, 90, 0, 0, 0, 0, 0, 0, 90, 0, 270, 90, 0, 0, 90, 0, 90, 90, 0, 90, 90, 90, 0},
            {0, 0, 0, 0, 0, 90, 90, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 90, 180, 0, 0, 180, 0, 0},
            {0, 270, 180, 0, 0, 0, 0, 0, 270, 90, 0, 270, 180, 0, 0, 0, 0, 270, 90, 0, 0, 0, 180, 0},
            {0, 0, 90, 90, 180, 0, 270, 90, 270, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 270, 270, 0, 90, 90, 270, 0, 90, 90, 0, 270, 0, 180, 0, 0, 270, 180, 180, 0, 270, 180, 0, 0},
            {0, 0, 90, 90, 90, 0, 0, 90, 270, 0, 0, 0, 0, 0, 270, 90, 270, 0, 0, 90, 90, 0, 90, 180},
            {0, 270, 90, 0, 0, 0, 0, 0, 0, 90, 0, 270, 90, 0, 90, 0, 0,180, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 270, 90, 90, 90, 180, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 270, 180, 0},
            {270, 90, 180, 0, 180, 270, 90, 90, 0, 0, 0, 0, 0, 270, 180, 0, 270, 90, 0, 0, 270, 90, 0, 0},
            {0, 0, 0, 270, 90, 0, 90, 90, 180, 0, 180, 0, 270, 90, 0, 0, 0, 180, 0, 270, 90, 0, 0, 0},
            {0, 0, 0, 180, 180, 270, 90, 90, 90, 0, 0, 270, 90, 0, 0, 0, 0, 0, 0, 0, 90, 90, 0, 90},
            {270, 90, 90, 90, 270, 90, 90, 90, 90, 90, 0, 270, 90, 90, 0, 90, 90, 270, 0, 0, 0, 0, 0, 0},

        };
        CreateStage();
    }
    void Update()
    {
        
    }
    public Sprite GetBlockSprite(int index){
        return blocksOne[index];
    }
    public void CreateStage(){
        int[,] stageBlocks;
        int[,] blockRotations;
        switch (GameManager.Instance.GetStagesPassed())
        { 
            case 0:
                stageBlocks = stageOneBlocks;
                blockRotations = stageOneRotations;
            break;
            case 1:
                stageBlocks = stageTwoBlocks;
                blockRotations = stageTwoRotations;
            break;
            default:
                stageBlocks = stageThreeBlocks;
                blockRotations = stageThreeRotations;
            break;
        }
        for (int i = 0; i < 25; i++)
        {
            for (int j = 0; j <47; j++)
            {
                int iSymmetry = i<=12? i : 24 - i ;
                int jSymmetry = j<=23? j : 46 - j;
                if(stageBlocks[iSymmetry,jSymmetry]!=0){
                    GameManager.Instance.AddBlockOnStage();
                    float xCoord = cornerX + j*0.29f;
                    float yCoord = cornerY - i*0.29f;
                    Quaternion blockRotation = Quaternion.Euler(0f,0f,blockRotations[iSymmetry,jSymmetry]*(i>12?-1:1)*(j>23?-1:1));
                    Block newBlock = Instantiate(block, new Vector2(xCoord,yCoord),blockRotation);
                    newBlock.SetBlockImage(blocksOne[stageBlocks[iSymmetry,jSymmetry]-1],stageBlocks[iSymmetry,jSymmetry]-1);
                    BulletTarget newBulletTarget = Instantiate(bulletTarget,new Vector2(xCoord,yCoord),Quaternion.identity);
                    newBlock.SetBulletTarget(newBulletTarget);
                    newBulletTarget.transform.SetParent(bulletTargets.transform);
                    newBulletTarget.SetBlock(newBlock);
                    switch(stageBlocks[iSymmetry,jSymmetry]){
                        case 1: newBlock.SetBlockHP(1);
                        break;
                        case 2: newBlock.SetBlockHP(2);
                        break;
                        case 3:
                        case 4:
                        case 5:
                        case 6:
                        case 7:
                        case 8: newBlock.SetBlockHP(3);
                        break;
                        case 9:
                        case 10:
                        case 11:
                        case 12:
                        case 13:
                        case 14: newBlock.SetBlockHP(4);
                        break;
                        default:
                        break;
                    }
                    newBlock.transform.SetParent(gameObject.transform); 
                    if(i>12){
                         
                         Vector3 currentScale = newBlock.transform.localScale;
                        currentScale.y *= -1;
                        newBlock.transform.localScale = currentScale;
                        
                    }
                    if(j>23){
                        
                      Vector3 currentScale = newBlock.transform.localScale;
                         currentScale.x *= -1;
                         newBlock.transform.localScale = currentScale;
                    }
                }
                
            }
        }
    }   
}
